<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Anchor Worm Detector</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: darkgreen; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        #preview { max-width: 300px; display: none; margin-top: 10px; }
        #result { font-size: 18px; margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>

    <h1>Anchor Worm Detector</h1>
    <p>Capture an image of the fish to check if it‚Äôs healthy or affected.</p>

    <button onclick="startCamera()">üì∑ Open Camera</button>
    <button onclick="restart()">üîÅ Restart</button>
    <br>

    <video id="camera" width="300" autoplay style="display:none;"></video>
    <canvas id="canvas" width="300" height="200" style="display:none;"></canvas>
    <br>
    <button id="captureBtn" onclick="capture()" style="display:none;">üì∏ Capture Image</button>

    <img id="preview" alt="Captured Image" />
    <p id="result"></p>

    <script>
        let video = document.getElementById('camera');
        let canvas = document.getElementById('canvas');
        let preview = document.getElementById('preview');
        let captureBtn = document.getElementById('captureBtn');
        let result = document.getElementById('result');
        let stream;

        // Sample reference images (base64) ‚Äì very small for demo
        // Reference healthy image (greenish color pattern)
        const healthyRGB = [120, 180, 120];

        // Reference infected image (reddish/orange tone near worm area)
        const infectedRGB = [200, 100, 100];

        function startCamera() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(s => {
                    stream = s;
                    video.srcObject = stream;
                    video.style.display = "block";
                    captureBtn.style.display = "inline-block";
                })
                .catch(err => alert("Camera not accessible: " + err));
        }

        function capture() {
            let ctx = canvas.getContext('2d');
            canvas.style.display = "block";
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            preview.src = canvas.toDataURL();
            preview.style.display = "block";
            analyzeImage();
        }

        function analyzeImage() {
            let ctx = canvas.getContext('2d');
            let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

            let r = 0, g = 0, b = 0, count = 0;

            // Sample pixel averages (basic color similarity test)
            for (let i = 0; i < imgData.length; i += 50) { 
                r += imgData[i];
                g += imgData[i + 1];
                b += imgData[i + 2];
                count++;
            }

            r = Math.floor(r / count);
            g = Math.floor(g / count);
            b = Math.floor(b / count);

            let healthyScore = Math.abs(r - healthyRGB[0]) + Math.abs(g - healthyRGB[1]) + Math.abs(b - healthyRGB[2]);
            let infectedScore = Math.abs(r - infectedRGB[0]) + Math.abs(g - infectedRGB[1]) + Math.abs(b - infectedRGB[2]);

            if (healthyScore < infectedScore) {
                result.innerHTML = "üü¢ Possibly Healthy Fish";
                result.style.color = "green";
            } else {
                result.innerHTML = "üî¥ Possibly Infected (check for Anchor Worm)";
                result.style.color = "red";
            }

            stopCamera();
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                video.style.display = "none";
                captureBtn.style.display = "none";
            }
        }

        function restart() {
            window.location.reload();
        }
    </script>
</body>
</html>
